<!DOCTYPE HTML>
<html>
	<head>
	    <title>Factorisation</title>
    	<script src="/javascripts/nmInclude.js"></script>
    	<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=AM_HTMLorMML"></script>
    	<script>
    	    var coeff=[],target,solutions=[];
    	    window.onload=layout;
    	    function lcf(a,b){
    	    	if(b==0)return a;
    	    	if(a%b){
    	    		return lcf(b,a%b);
    	    	}else return b;
    	    }
    	    function decMul(a,b){
    	    	var temp=[a[0]*b[0],a[1]*b[1]];
    	    	var cf=lcf(temp[0],temp[1]),res=[temp[0]/cf,temp[1]/cf];
    	    	return res;
    	    }
    	    function decDiv(a,b){
    	    	var temp=[a[0]*b[1],a[1]*b[0]];
    	    	var cf=lcf(temp[0],temp[1]),res=[temp[0]/cf,temp[1]/cf];
    	    	return res;
    	    }
    	    function decPow(a,b){
    	    	if(b==0)return [1,1];
    	    	if(b==1)return a;
    	    	var temp=decPow(decMul(a,a),Math.floor(b/2));
    	    	if(b&1)return decMul(a,temp);
    	    	else return temp;
    	    }
    	    function decAdd(a,b){
    	    	var temp=[a[0]*b[1]+a[1]*b[0],a[1]*b[1]];
    	    	var cf=lcf(temp[0],temp[1]),res=[temp[0]/cf,temp[1]/cf];
    	    	return res;
    	    }
    	    function decSub(a,b){
    	    	var temp=[a[0]*b[1]-a[1]*b[0],a[1]*b[1]];
    	    	var cf=lcf(temp[0],temp[1]),res=[temp[0]/cf,temp[1]/cf];
    	    	return res;
    	    }
    	    function check(coeff,n,x){
    	    	var s=[0,1];
    	    	for(var i=0;i<n;i++){
    	    		s=decAdd(s,decMul(coeff[i],decPow(x,n-i-1)));
    	    	}
    	    	target.innerHTML+=x+":"+s+"<br>";
    	    	if(s[0]!=0)return false;else return true;
    	    }
    	    function next(coeff,n,x){
    	    	var nxt=[],temp=coeff;
    	    	for(var i=0;i<n-1;i++){
    	    		nxt.push(temp[i]);
    	    		temp[i+1]=decAdd(temp[i+1],decMul(x,temp[i]));
    	    	}
    	    	if(temp[n-1][0]!=0)target.innerHTML+="error<br>";
    	    	return nxt;
    	    }
    	    function root(coeff,n){
    	    	var output='<h4>'+n+":";
    	    	for(var i=0;i<n;i++){
    	    		output+=coeff[i][0]+"/"+coeff[i][1]+" ";
    	    	}
    	    	output+='</h4><br>';
    	    	target.innerHTML+=output;
    	    	if(n==2){solutions.push(decDiv(coeff[1],coeff[0]));return;}
    	    	var A=factorise(coeff[0]),B=factorise(coeff[n-1]);
    	    	for(var i=0;i<A.length;i++){
    	    		for(var j=0;j<B.length;j++){
    	    			if(check(coeff,n,[B[j],A[i]])){
    	    				target.innerHTML+=[B[j],A[i]]+"<br>";
    	    				solutions.push([1,1],decMul([B[j],A[i]],[-1,1]));
    	    				root(next(coeff,n,[B[j],A[i]]),n-1);
    	    				return;
    	    			}
    	    		}
    	    	}
    	    	solutions.push(coeff);
    	    }
    	    function factorise(A){
    	    	if(A.length)A=A[0];
    	    	var factors=[];
    	    	for(var i=1;i<=Math.sqrt(A);i++){
    	    		if(A%i==0){
    	    			if(A/i==i){
    	    				factors.push(i);
    	    				factors.push(-i);
    	    			}else{
    	    				factors.push(i);
    	    				factors.push(-i);
    	    				factors.push(A/i);
    	    				factors.push(-A/i);
    	    			}
    	    		}
    	    	}
    	    	return factors;
    	    }
    	    function solve(){
    	    	var p=0,str=document.getElementById("value").value;target=document.getElementById("res");
    	    	coeff=[];
    	    	for(var i=0;i<str.length;i++){
    	    		if(str[i]==' '){coeff.push([p,1]);p=0;}
    	    		else{
    	    			p=p*10+parseInt(str[i]);
    	    		}
    	    	}
    	    	if(p!=0)coeff.push([p,1]);
    	    	target.innerHTML=coeff;
    	    	solutions=[];
    	    	root(coeff,coeff.length);
    	    	target.innerHTML=solutions.length+"<br>";
    	    	for(var i=0;i<solutions.length;i++){
    	    		target.innerHTML+="`"+solutions[i][0]+"/"+solutions[i][1]+"`<br>";
    	    	}
				formulae();
    	    }
    	</script>
    	<style>
    	    input{
    	        width:100%;
    	        font-size:15px;
    	        text-align:center;
    	        border:1px solid #DDD;
    	    }
    	</style>
	</head>
	<body>
	    <h1 id="heading">Factorisation Tool</h1>
	    <div>Transform the eqation into the form of `a`<sub>`0`</sub>`x^n+a`<sub>`1`</sub>`x^(n-1)+...+a`<sub>`n`</sub>`=0`, and then input `a`<sub>`0`</sub> to `a`<sub>`n`</sub> with a space between each two neighbooring numbers below:</div>
    	<input id="value" placeholder="Input the numbers here">
    	<a href="javascript:solve()" id="solve" style="width:100%;text-align:center" class="block">`Solve!`</a>
    	<div style="width:100%" id="res"></div>
    	<script>
    	</script>
    </body>
</html>
